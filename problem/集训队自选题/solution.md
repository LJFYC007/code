将限制转化后变为: 选定一对基底 $\vec{r_1}, \vec{r_2}$ 和一个原点，使得所有黑点可以在这个原点下，被这个基底用整数系数线性组合

平凡的，$\vec{r_1}=(1,0),\vec{r_2}=(0,1)$ 一定是一个合法解，但是我们还需要加入的黑点最少

容易发现，对于所有合法方案，在基底模长最长的情况下，$K$ 最小

设给定的所有点有 $\vec{v_i}=(a_i,b_i)$ ，则一个满足条件的基底，当且仅当 $\forall i\not= j$ 有 $\vec{v_i}-\vec{v_j}$ 可以被这个基底用整数系数线性组合。容易发现，我们只需要满足 $\forall i\in[1,n-1]$ 有 $\vec{v_i}-\vec{v_{i+1}}$ 可以被组合出来

所以问题转化为了给定 $n$ 个向量 $\vec{w_i}$ （此处 $n$ 为原题意中的 $n-1$ ），求一个模长最长的基底可以组合出所有 $\vec{w_i}$

如果我们求解出前 $i$ 个向量的最长合法基底 $\vec{r_1},\vec{r_2}$ ，那么只要可以求解出 $\vec{w_{i+1}},\vec{r_1},\vec{r_2}$ 的最长合法基底。而且可发现，若一个基底可以组合出 $(s,t)$ ，那么一定可以组合出 $(t,-s)$ ，所以问题再次化简为求解出 $\vec{w_{i+1}},\vec{r_1}$ 的最长合法基底

简化一下记号，即求 $\vec{a},\vec{b}$ 的最长合法基底。首先给出做法如下：

- 不妨认为两者中模长较长的为 $\vec{a}$ ，较短的为 $\vec{b}$ ，令 $\vec{c}$ 为 $\vec{b}$ 的四个方向向量中的任意一个
- 若 $\vec{a}-\vec{c}$ 的模长小于 $\vec{a}$ 的模长，$\vec{a}=\vec{a}-\vec{c}$
- 若 $\vec{a}$ 的模长等于 $0$ ，则 $b$ 即为所求基底，否则回到第一步

现在需要说明的是，按照这个操作，每次一定可以使 $\vec{a}$ 的模长减小

考虑将 $\vec{b}$ 旋转后建立平面直角坐标系，令 $\vec{c}$ 在 $x,y$ 轴上，假设当前 $\vec{c}$ 为 $x$ 正半轴的基底

那么做 $\vec{c}$ 的垂直平分线，若 $\vec{a}$ 在垂直平分线的右侧，则 $\vec{a}-\vec{c}$ 的模长一定小于 $\vec{a}$ 的模长

发现，四条垂直平分线覆盖了包含原点的一个边长为 $|\vec{c}|$ 的小正方形外的所有向量，也就是说，我们每轮操作可以重复进行（因为这个过程中一直满足 $|\vec a|>|\vec c| $ ，所以可以在 $O(log)$ 时间内使用倍增算法重复进行多次），直到 $\vec{a}$ 的模长变为 $\leq \frac{|\vec{c}|}{2}$ 。因此，一定可以使 $\vec{a}$ 的模长减小，且该操作的运行次数为 $log 10^9$ 级别

当我们求得基底后，得到 $\forall i\in[2,n]$ 中，$\vec{a_i}-\vec{a_1}=x_i\vec{r_1}+y_i\vec{r_2}$ ，那么 $K=\max\{maxx_i-minx_i,maxy_i-miny_i\}+1$

复杂度为 $O(n log^2)$。

