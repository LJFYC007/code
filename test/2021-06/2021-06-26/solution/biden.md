本题求方案数是一个背包问题，dp 没有前途，我们考虑生成函数。

我们记 $cur_i$ 表示当前原材料 $i$ 的数量，$w_i$ 表示原材料 $i$ 的奇异口感。

那么其 OGF 为 
$$
F_i=\sum_{k=0}^{cur_i}x^{k\times w_i}.
$$
最终答案为
$$
ans=\sum_{i=1}^k[x^i](\prod_{j=l}^r F_j).
$$
注意到所有原材料的奇异口感之和不超过 $5000$，所以我们只需要在 $\bmod x^{5001}$ 意义下运算。用 NTT 加速多项式乘法并且用线段树维护即可。

进一步，由于无论如何最高次项的指数都不会超过 $5000$，我们不需要中途取模。可以将 $[l,r]$ 内的点值全部乘起来再转回去。

记 $W=8192$，我们开 $W$ 棵线段树来维护点值。修改和查询都直接暴力在 $W$ 棵线段树上面搞。时间复杂度 $O(W(n+m\log n+m\log W))$。

更进一步，发现所有 NTT 求点值与点值求系数的过程为 $O(mW)$ 次以某个原根为公比的等比数列求和，可以预处理后每次 $O(1)$ 求得。时间复杂度 $O(W(n+m\log n))$。
