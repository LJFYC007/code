# 湖南省队集训 Day8

| 题目名称       | 开心消消乐 | 树上的棋局 | 社会黄油飞          |
| -------------- | ---------- | ---------- | ------------------- |
| 题目类型       | 传统题     | 传统题     | 传统题              |
| 目录           | game       | tree       | socialbutterfly     |
| 可执行文件名   | game       | tree       | socialbutterfly     |
| 输入文件名     | game.in    | tree.in    | socialbutterfly.in  |
| 输出文件名     | game.out   | tree.out   | socialbutterfly.out |
| 每个测试点时限 | 1.0 秒     | 2.0 秒     | 2.0 秒              |
| 内存限制       | 512 MB     | 512 MB     | 512 MB              |

**注意事项**

1. 评测时编译选项：`-std=c++11 -O2`
2. 题目可能较水，如果 `AK` 了请不要大声喧哗影响旁边同学睡觉、扫雷、 5×5 、 Adventure 、 Blackbox 、 Bubbles 、 Gomoku 、 Towers of Hanoi 、 Life 、 Multiplication Puzzle 、 Pong 、 Snake 、 Solitaire 、 Tetris 、 Zone Out 。



























## 开心消消乐

#### 题目信息与限制

文件名：`game`

时间限制：$\rm 1s$

空间限制：$512 {\rm MiB}$

#### 题目描述

`Kewth` 是 `OI` 游戏两开花的神仙。最近他在 `T****p` 上找到一个新奇的消消乐游戏。这款游戏的目标是，将一串有着黑白两种颜色的球消除到只剩下一个球。若剩下的球是白色的则会获得游戏的胜利。

每次消除操作可以简化成依次执行下面几个步骤：

1. 选择一段长度为正奇数的前缀 $S$。
2. 然后从后往前依次取出 $S$ 的最后三个球，根据这三个球的颜色将其变成一个黑色或者白色的球并放回去。重复此步骤直到只剩下一个球。
3. 将这个球放回到原来的序列前端。

其中，步骤二生成的球的颜色的确定规则会在每个关卡开始的时候给定。

现在这个消消乐开了夏活，活动关卡中，会在一些位置上放置“混沌球”，在你开始进行消除操作之前，你需要给每一个“混沌球”染上黑色或者白色。

`Kewth` 是一个善于思考的神，于是他就想，能不能算出有多少种给“混沌球”染色的方案，使得局面是可以获胜的？

打开了关卡后，`Kewth` 在 $10^{-100} s$ 内就计算出了答案。为了证明你不比 `Kewth`  菜 $10^{100}$ 倍，你需要在 $1s$ 内计算出结果。

`Kewth` 知道凡人不希望计算过大的数字，于是你只需要告诉他你的答案对 $998244353$ 取模的结果就行了。

#### 输入格式

第一行一个正整数 $T$，表示 `Kewth` 需要你计算一共 $T$ 个关卡。

接下来 $T$ 组关卡信息。这里我们使用 $0$ 表示颜色为黑色的球，$1$ 表示颜色为白色的球。每组关卡信息的第一行是一个长度为 $8$ 的 `01` 串，其中第 $i$ 个字符表示当从后往前取出的三个字符依次排列为 $i$ 的二进制表示（如，$00001$ 进行一次步骤 $2$，取出的依次为 $1,0,0$，对应的 $i$ 即为 $4$）时，放回去的球是黑色还是白色。第二行是一个长度为 $n$ 的仅包含 `01?` 的字符串，表示当前关卡中黑球、白球、混沌球的排列顺序，保证 $n$ 为奇数。

#### 输出格式

对于每一个关卡，你都需要告诉 `Kewth` 你认为能获胜的局面数模 $998244353$ 的结果。

具体的，输出共 $T$ 行，每行一个非负整数，表示答案对 $998244353$ 取模的结果。

#### 输入输出样例

| `game1.in` | `game1.ans` |
| -------- | -------- |
| 1<br>10001100<br>0000001 | 1 |

##### 样例一解释

注意到有且仅有一种可能的给所有混沌球染色的方案。那么仅考虑这个情况，我们可以先选择一个长度为 $5$ 的前缀 $00000$，将其消除：$00000 \rightarrow 001 \rightarrow 1$，然后将 $1$ 放回得到 $101$。再进行一次消除即可得到 $1$。

| `game2.in` | `game2.ans` |
| -------- | -------- |
| 1<br>11100111<br>??? | 6 |

#### 数据范围与约定

对于 $100\%$ 的数据：保证 $1 \leq T \leq 10, 1 \leq n \leq 10^5$，且 $n$ 为奇数。

| 数据编号 | 额外限制 | 特殊性质 |
| ------- | ------ | ------- |
| 1,2,3 | $1\le n \le 2\times 10^3$ | C |
| 4,5,6,7 | $1\le n\le 2\times 10^3$ | A |
| 8,9,10,11 | $1\le n\le 2\times 10^3$ | B |
| 12,13,14,15 | 无 | A |
| 16,17,18,19 | 无 | B |
| 20 | 无 | C |

特殊性质 A：保证初始游戏局面不存在 '?'。

特殊性质 B：保证消除规则为 `00010111`。

特殊性质 C：无特殊限制。























## 树上的棋局

#### 题目信息与限制

文件名：`tree`

时间限制：$\rm 2s$

空间限制：$\rm 512MiB$

#### 题目描述

`CYJian` 是个喜欢恰烂钱的屑。这天他又在经典题上加东西卖出去恰烂钱了。

原题是这样的：

给定一颗 $n$ 个节点的树，初始的时候 $1$ 号点为树根，且树上每个点初始都有一个棋子。`Silver Ash` 和 `Doctor` 会轮流移动棋子，每次移动的棋子 $x$ 可以被放置到其所在节点的任意一个儿子节点的子树的任意一个点上。不能操作的人判负。求先手是否有必胜策略。

相信在座的各位都是实力超群的人，这个经典 `SG` 函数练习题大家应该一眼就秒了。但是 `CYJian` 当然不可能出这么愚蠢的过不了审的经典题来恰烂钱，于是他选择了加上几个花里胡哨的操作：

1. 给定 $u,v,x$，表示先将树上 $u,v$ 之间路径上的所有点都加上一个棋子，然后把树根调整为 $x$，最后输出此局面的 `SG` 值。
2. 给定 $u,x$，表示将 $u$ 的子树内的所有点都加上一个棋子（注意此时的树根），然后把树根调整为 $x$，最后输出此局面的 `SG` 值。

`CYJian` 很快就写完了代码造好了数据，但是他不确定自己有没有写挂，于是他找到了来参加省队集训的你来帮忙验一下他的数据是否正确。

---

关于 $\rm SG$ 值：在公平博弈中，$\rm SG$ 值是判断先手是否有必胜策略的利器。$\rm SG$ 值是描述博弈中的局面的一个值。对于一个局面，计算其 $\rm SG$ 值的一般方法是，计算出所有其能一步到达的状态的 $\rm SG$ 值集合的 $\rm mex$。对于一个非负整数集合，其 $\rm mex$ 定义为最小的未在集合中出现过的非负整数。

#### 输入格式

第一行两个整数 $n, m$ 分别表示树上的点数以及操作数。

接下来 $n-1$ 行，每行两个正整数 $u, v$ 表示树上的一条边。

接下来 $m$ 行，每行的第一个值为 $1$ 或者 $2$ 的正整数表示操作的类型，接下来的 $2 \sim 3$ 个数的意义参照题面描述。

#### 输出格式

$m$ 行，每行一个非负整数，表示每次操作后，整棵树进行一次游戏，此游戏初始局面的 `SG` 值。





#### 输入输出样例

| `tree1.in`                                                   | `tree1.ans`                   |
| :----------------------------------------------------------- | :---------------------------- |
| 5 5<br />1 2<br />1 3<br />3 4<br />3 5<br />1 4 5 1<br />1 1 3 1<br />2 1 3<br />2 3 4<br />1 3 4 4 | 2<br />1<br />1<br />2<br />3 |

#### 数据范围与约定

本题采用子任务捆绑评测。

对于 $100\%$ 的数据：$1 \leq n \leq 2 \times 10^5$，$0 \leq m \leq 2\times 10^5$。

| 分值 | 子任务编号 | 额外限制 | 特殊性质 |
| ------- | ------ | ------- | ---- |
| 4' | 1 | $m=0$ | 无 |
| 4' | 2 | $1\le n\le 2$ | 无 |
| 8' | 3 | $1\le n\le 5$ | 无 |
| 8' | 4 | $1\le m\le 5$ | 无 |
| 12' | 5 | $1 \leq n,m \leq 10^3$ | 无 |
| 16' | 6 | 无 | A |
| 16' | 7 | $u=v$ | B |
| 16' | 8 | 无 | B |
| 16' | 9 | 无 | 无 |

特殊性质 A：保证每次操作的 $x=1$。

特殊性质 B：保证仅有 1 操作。













## 社会黄油飞

#### 题目信息与限制

文件名：socialbutterfly

时间限制：$\rm 2s$

空间限制：$\rm 512MiB$

#### 题目描述

`justin_cao` 是个高情商的帅小伙，自然而然的就与许多同学成了好朋友。

高考结束后，他想从 $n$ 个同学中找些同学一起出去玩。不幸的是，不同的同学因为找了不同的老师报了不同的羟基补习班，所以时间就不一定合得来。具体的说，在长达 $2^n-1$ 天的暑假中，第 $i$ 个同学有空当且仅当，这天是放暑假的第 $j$ 天（$j \in [1, 2^n-1]$，且 $j$ 的二进制表示的第 $i$ 位为 $1$）。

`justin_cao` 还觉得，找同学一起出去玩肯定需要这些同学的关系都不赖。经过这么久的相处，`justin_cao` 对于每对同学间的关系自然有个谱。他用了一张 $n$ 个节点的无向图 $G$ 表示这 $n$ 个同学间的关系，图中可能会有重边，两个点之间的边越多就表示这两个同学间的关系越好。

`justin_cao` 认为，当邀请的同学的集合为 $S$ 的时候，这些同学之间的关系可以用这个公式量化：
$$
f(S) = 
\begin{cases}
\frac{\sum_{(u,v)\in G}[u\in S][v\in S]}{|S|-1}& |S|>1\\
0& |S|=1
\end{cases}
$$
注意此处重边需要计算多次。

当某一天可以邀请到的所有同学的集合为 $S$，且当天的 $f(S)$ **大于** `justin_cao` 心中的阈值 $lim$ 的时候，`justin_cao` 就会邀请所有能邀请的同学一起出去玩。`justin_cao` 希望你能帮忙算算，能不能找到这样的一天。

#### 输入格式

第一行三个正整数 $n, m, lim$，分别表示无向图 $G$ 的点数、边数，以及神秘的阈值。

接下来 $m$ 行，每行两个正整数 $u, v$ 表示无向图 $G$ 中的一条边。可能存在重边，但是保证不存在自环。

#### 输出格式

如果存在这样的一天，输出 `Yes`，否则输出 `No`。

#### 输入输出样例

| socialbutterfly.in                       | socialbutterfly.ans |
| ---------------------------------------- | ------------------- |
| 3 5 2<br>1 2<br>2 1<br>2 3<br>3 2<br>1 3 | Yes                 |
| 3 4 2<br/>1 2<br/>2 1<br/>2 3<br/>3 2    | No                  |

#### 数据范围与约定

本题采用子任务捆绑评测。

对于 $100\%$ 的数据：$1 \leq n \leq 2 \times 10^3$，$1 \leq m \leq 6 \times 10^3$，$1 \leq lim \leq 70$。

| 分值 | 子任务编号 | 额外限制 | 特殊性质 |
| ------- | ------ | ------- | ---- |
| 10' | 1 | $n \leq 10,m \leq 100$ | A |
| 10' | 2 | $n \leq 50,m \leq 250$ | A |
| 20' | 3 | $n \leq 100,m \leq 450$ | A |
| 15' | 4 | $n \leq 50,m \leq 400$ | 无 |
| 15' | 5 | $n \leq 300,m \leq 10^3$ | 无 |
| 30' | 6 | 无 | 无 |

特殊性质 A：保证 $G$ 随机生成。