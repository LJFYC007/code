题目大意：给你若干个石子，石子有颜色，求所有序列下首位相接后极长连续段的长度的阶乘分之一的乘积之和。

我们考虑加入若干个隔板：首先相邻不同色则一定需要加入一个隔板，然后考虑相同颜色我们也可以加入一个隔板（或不加入）。然后在计算的时候对每个分割情况算每一段颜色相同的方案数。

这个时候每一段的区间是固定的。那么我们考虑给每一个长度加一个权值 $a_i$，一个分割的权值是每段的权值之和。

那么设：

$$
F = \sum_i a_i x^i
\\
G = e^x-1
$$

则有：

$$
\begin{aligned}
\frac{F}{1-F}&= G
\\
F&=\frac{G}{G+1}
\\
F&=\frac{e^x-1}{e^x}
\end{aligned}
$$

考虑一种分割：我们不断向后循环位移，直到序列上存在一个分割点在 $i$ 到 $n$ ，这样会唯一对应到一个分割情况。那么我们可以考虑将所有分割后的段分配出来，然后第一段需要多带一个长度的权值（表示实际循环位移了多少)。

那么我们只需要算出来每种颜色分成 $i$ 段，每段权值是 $T$ 的方案数即可（还需要分第一段是否是所有的第一段）。

如果不是，那么即求：

$$
g(i) = [x^n]F^i
$$

如果是，即求：

$$
g(i) = [x^n]F^{i-1}*F'*x\\
= [x^{n-1}](F^{i})'*\frac{1}{i}\\
= [x^{n}](F^{i})*\frac{n}{i}
$$

那么求出来第一个就行了。这里求一个 $F$ 的复合逆就能算。

而 $F$ 的复合逆 $H$：

$$
e^H-1=x*e^H
\\
e^H=\frac{1}{1-x}
\\
e^H=\ln(\frac{1}{1-x})
$$

最后 分治FFT 即可。

复杂度是 $O(\sum a_i\log a_i +n\log n\log m)$。d
